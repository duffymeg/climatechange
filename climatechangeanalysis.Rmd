---
title: "Views on climate change of Intro Bio students"
author: "Meghan Duffy"
date: "March 7, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#What are the views of Introductory Biology students on climate change? And do those views change after taking Intro Bio?

This project involved surveying Intro Bio students in Fall 2017 and Fall 2018. The survey included both Likert-style questions and open-ended questions.

Note: only analyzing data from students who took both the pre- and the post-surveys. Also only analyzing data for students who answered validation question correctly.

```{r, load libraries}
library(tidyverse)
library(cowplot)
library(likert)
library(BSDA)
```

```{r, load F2017 data}
ccdata <- read.csv("ccsurvey_F17_quantitative.csv", na.strings = "NA")
colnames(ccdata)

cctookboth <- subset(ccdata, took_pre_CC == 1 & took_post_CC == 1)
cctookboth <- subset(cctookboth, CC_Validation_pre == "SomewhatAgree" & CC_Validation_post == "SomewhatAgree")
```

Yikes! 49 of the 169 people who took both surveys didn't answer the validation question correctly on both surveys. That leaves us with 120 students.

```{r, load W18 data}
ccdataw18 <- read.csv("ccsurvey_WN18_quantitative.csv")
colnames(ccdataw18)

cctookbothw18 <- subset(ccdataw18, took_pre_CC == 1 & took_post_CC == 1)
cctookbothw18 <- subset(cctookbothw18, CCPost_Validation_post == "SomewhatAgree")
```

### Combined data set
```{r, combine F17 and W18 data sets}
cctookbothtocombineF17 <- cctookboth[c("CC_Happening_pre","CC_Happening_post","CC_Worried_pre","CC_Worried_post","CC_ScientistsWhether_pre","CC_ScientistsWhether_post","CC_ScientistsWhy_pre","CC_ScientistsWhy_post","CC_ConsensusCause_pre","CC_ConsensusCause_post","CC_Thought_pre","CC_Thought_post","CC_ChangedMe_post")]
cctookbothtocombineW18 <- cctookbothw18[c("CCPre_Happening_pre","CCPost_Happening_post","CCPre_Worried_pre","CCPost_Worried_post","CCPre_ScientistsWhether_pre","CCPost_ScientistsWhether_post","CCPre_ScientistsWhy_pre","CCPost_ScientistsWhy_post","CCPre_ConsensusCause_pre","CCPost_ConsensusCause_post","CCPre_Thought_pre","CCPost_Thought_post","CCPost_ChangedMe_post")]

cctookbothtocombineW18 <- dplyr::rename(cctookbothtocombineW18, CC_Happening_pre=CCPre_Happening_pre, CC_Happening_post=CCPost_Happening_post,CC_Worried_pre=CCPre_Worried_pre,CC_Worried_post=CCPost_Worried_post,CC_ScientistsWhether_pre=CCPre_ScientistsWhether_pre,CC_ScientistsWhether_post=CCPost_ScientistsWhether_post,CC_ScientistsWhy_pre=CCPre_ScientistsWhy_pre,CC_ScientistsWhy_post=CCPost_ScientistsWhy_post,CC_ConsensusCause_pre=CCPre_ConsensusCause_pre,CC_ConsensusCause_post=CCPost_ConsensusCause_post,CC_Thought_pre=CCPre_Thought_pre,CC_Thought_post=CCPost_Thought_post,CC_ChangedMe_post=CCPost_ChangedMe_post)

cctookbothtocombineF17$Semester <- "F17"
cctookbothtocombineW18$Semester <- "W18"

cctookbothcombined <- bind_rows(cctookbothtocombineF17,cctookbothtocombineW18)
```

# Do the students think climate change is happening?
Students were asked: Do you think that climate change is happening?
Options:
- Yes, and I'm extremely sure
- Yes, and I'm very sure
- Yes, and I'm somewhat sure
- Yes, but I'm not at all sure
- No, and I'm extremely sure
- No, and I'm very sure
- No, and I'm somewhat sure
- No, but I'm not at all sure
- I don't know

```{r, summarize combined data}
CCHappeningPrecombined <- cctookbothcombined$CC_Happening_pre
CCHappeningPrecombined <- as.data.frame(CCHappeningPrecombined)
names(CCHappeningPrecombined)[1] = c("Answer")

CCHappeningPostcombined <- cctookbothcombined$CC_Happening_post
CCHappeningPostcombined <- as.data.frame(CCHappeningPostcombined)
names(CCHappeningPostcombined)[1] = c("Answer")

CCHappeningPrecombined$prepost <- rep("pre",nrow(CCHappeningPrecombined))
CCHappeningPostcombined$prepost <- rep("post",nrow(CCHappeningPostcombined))

CCHappeningDataBindcombined <- bind_rows(CCHappeningPrecombined,CCHappeningPostcombined)

CCHappeningDataBindcombined$Answer <- factor(CCHappeningDataBindcombined$Answer, 
                                            c("YesExtrSure",
                                              "YesVerySure", 
                                              "YesSomeSure",
                                              "YesNotSure",
                                              "DK",
                                              "NoSomeSure"))

CCHappeningDataBindcombined$prepost <- factor(CCHappeningDataBindcombined$prepost, 
                                            c("pre",
                                              "post"))
```


```{r, likert analysis of cc_happeningcombined data}
cchappeningresponsescombined <- CCHappeningDataBindcombined %>%
  select(Answer)

CCHappeningDataBindcombined$prepost <- plyr::mapvalues(CCHappeningDataBindcombined$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCHappeningDataBindcombined$prepost <- factor(CCHappeningDataBindcombined$prepost, c("Post","Pre"))

# rename the responses and order the data
cchappeningresponsescombined$Answer <- plyr::mapvalues(cchappeningresponsescombined$Answer, from = c("YesExtrSure",
                                              "YesVerySure", 
                                              "YesSomeSure",
                                              "YesNotSure",
                                              "DK",
                                              "NoSomeSure"), 
                                              to = c("Yes, extremely sure",
                                                     "Yes, very sure",
                                                     "Yes, somewhat sure",
                                                     "Yes, but not sure",
                                                     "I don't know",
                                                     "No, somewhat sure"))


cchappeningresponsescombined$Answer <- factor(cchappeningresponsescombined$Answer, 
                                 c("No, extremely sure",
                                   "No, very sure",
                                   "No, somewhat sure",
                                    "No, but not sure",
                                    "I don't know",
                                    "Yes, but not sure",
                                    "Yes, somewhat sure",
                                    "Yes, very sure",
                                    "Yes, extremely sure"))

cchappeningresponsescombined_grouping <- CCHappeningDataBindcombined %>%
  select(prepost)



counts = CCHappeningDataBindcombined %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(cchappeningresponsescombined)[1] <- "Do you think climate change is happening?"
likert_cchappeningcombined <- likert(cchappeningresponsescombined, grouping = cchappeningresponsescombined_grouping$prepost)

library(scales)
cchappeninglikertplotcombined = plot(likert_cchappeningcombined,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  guides(fill = guide_legend(nrow=3))


cchappeninglikertplotcombined <- ggplot_gtable(ggplot_build(cchappeninglikertplotcombined))
cchappeninglikertplotcombined$layout$clip <- "off"
cchappeninglikertplotcombined.mpg <- plot(cchappeninglikertplotcombined)

plot(cchappeninglikertplotcombined)

save_plot("cchappeninglikertplotcombined.jpg", cchappeninglikertplotcombined, base_width = 8, base_height = 5)
```

```{r, summary data for combined cchappening data}
CChappeningsummarycombined <- CCHappeningDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CChappeningsummarycombined

```

```{r, significant shift in happening with combined data}
extrhappening <- prop.test(x = c(164, 266), n = c(372, 372))
extrhappening 
```

# Who do students think is causing climate change?
```{r, beliefs about cause}
CCBeliefsPre <- cctookboth$CC_Beliefs_pre
CCBeliefsPre <- as.data.frame(CCBeliefsPre)
names(CCBeliefsPre)[1] = c("Answer")

CCBeliefsPost <- cctookboth$CC_Beliefs_post
CCBeliefsPost <- as.data.frame(CCBeliefsPost)
names(CCBeliefsPost)[1] = c("Answer")

CCBeliefsPre$prepost <- rep("pre",nrow(CCBeliefsPre))
CCBeliefsPost$prepost <- rep("post",nrow(CCBeliefsPost))

CCBeliefsDataBind <- bind_rows(CCBeliefsPre,CCBeliefsPost)

CCBeliefsDataBind$prepost <- factor(CCBeliefsDataBind$prepost, 
                                            c("pre",
                                              "post"))
```

Summary: The percentage of students who identified humans as the primary cause of climate change increased from 69% on the pre-survey to 91% on the post-survey.



```{r, trying a stacked bar chart for student beliefs data}
CCBeliefsDataBindAll <- CCBeliefsDataBind

CCBeliefsDataBindAll$Answer <- plyr::mapvalues(CCBeliefsDataBindAll$Answer , from = c("Both", "Humans", "Natural", "Other", "ExtentUnknown","NotHappening"), to = c("Equally humans and natural","Mostly humans", "Mostly natural", "Other", "Contributions unknown or unknowable", "Climate change is not happening"))

CCBeliefsDataBindAll$prepost <- plyr::mapvalues(CCBeliefsDataBindAll$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCbeliefssummaryall <- CCBeliefsDataBindAll %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), digits=1))

CCbeliefssummaryall

samplesizes <- CCBeliefsDataBindAll %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n()) 

samplesizes


# order the responses
CCbeliefssummaryall$Answer <- factor(CCbeliefssummaryall$Answer, 
                                 c("Other",
                                   "Climate change is not happening",
                                   "Mostly natural",
                                   "Contributions unknown or unknowable",
                                   "Equally humans and natural",
                                   "Mostly humans"))


CCBeliefsDataBindAll$prepost <- factor(CCBeliefsDataBindAll$prepost,
                                       c("Pre","Post"))

ccbeliefsstackedbarplot <- ggplot(CCbeliefssummaryall, aes(y=rel.freq, x=prepost)) + 
    geom_col(aes(fill=Answer)) +
  ylab("Percent of responses") +
  xlab("Timing of survey") +
  scale_fill_manual(values=c("gray","#8c510a","#d8b365","#f6e8c3","#ABD9D5","#01665e")) +
  ggtitle("Which best captures your beliefs \nabout the cause(s) of climate change?") +
  guides(fill=guide_legend(title="Response"))  +
  ylim(0,105) +
  annotate("text", x = 1, y = 105, label = paste("n = 120")) +
  annotate("text", x = 2, y = 105, label = paste("n = 119")) +
  theme_bw() 
  

  ccbeliefsstackedbarplot

save_plot("ccbeliefsstackedbarplot.jpg", ccbeliefsstackedbarplot, base_width = 6.5, base_height = 5)

```

```{r, test for significant shift in beliefs}


mostlyhumans <- prop.test(x = c(83, 109), n = c(120, 119))
mostlyhumans 

equally <- prop.test(x = c(26, 6), n = c(120, 119))
equally
```

## The scientific consensus is that climate change is caused mostly by humans activities. Do students agree?

CC_ConsensusCause
The scientific consensus is that climate change is
o Caused mostly by human activities
o Caused mostly by natural changes in the environment
o Caused equally by both human activities and natural changes in the environment
o Other
o Not happening
o I don’t know what the scientific consensus is
o There is no scientific consensus

```{r, beliefs about cause using combined data}
CCConsensusCausePrecombined <- cctookbothcombined$CC_ConsensusCause_pre
CCConsensusCausePrecombined <- as.data.frame(CCConsensusCausePrecombined)
names(CCConsensusCausePrecombined)[1] = c("Answer")

CCConsensusCausePostcombined <- cctookbothcombined$CC_ConsensusCause_post
CCConsensusCausePostcombined <- as.data.frame(CCConsensusCausePostcombined)
names(CCConsensusCausePostcombined)[1] = c("Answer")

CCConsensusCausePrecombined$prepost <- rep("pre",nrow(CCConsensusCausePrecombined))
CCConsensusCausePostcombined$prepost <- rep("post",nrow(CCConsensusCausePostcombined))

CCConsensusCauseDataBindcombined <- bind_rows(CCConsensusCausePrecombined,CCConsensusCausePostcombined)

CCConsensusCauseDataBindcombined$prepost <- factor(CCConsensusCauseDataBindcombined$prepost, 
                                            c("pre",
                                              "post"))
```

```{r, summarizing combined data on consensus cause}
CCconsensuscausesummarycombined <- CCConsensusCauseDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCconsensuscausesummarycombined

samplesizes <- CCConsensusCauseDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n())

samplesizes
```


```{r, another test for significant shift in beliefs}
mostlyhumans <- prop.test(x = c(230, 299), n = c(372, 383))
mostlyhumans 

equally <- prop.test(x = c(70, 45), n = c(372, 383))
equally
```

```{r, trying a stacked bar chart for consensus cause data for combined data}
CCConsensusCauseDataBindAllcombined <- CCConsensusCauseDataBindcombined %>%
    filter(Answer != "")

CCConsensusCauseDataBindAllcombined$Answer <- plyr::mapvalues(CCConsensusCauseDataBindAllcombined$Answer , from = c("Both", "Humans", "Natural", "Other", "DK","NoConsensus"), to = c("Equally humans and natural","Mostly humans", "Mostly natural", "Other", "I don't know", "There is no scientific consensus"))


CCConsensusCauseDataBindAllcombined$prepost <- plyr::mapvalues(CCConsensusCauseDataBindAllcombined$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCconsensuscausesummaryallcombined <- CCConsensusCauseDataBindAllcombined %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), digits=1))

CCconsensuscausesummaryallcombined

samplesizes <- CCConsensusCauseDataBindAllcombined %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n()) 

samplesizes

# order the responses
CCconsensuscausesummaryallcombined$Answer <- factor(CCconsensuscausesummaryallcombined$Answer, 
                                 c("Other",
                                   "There is no scientific consensus",
                                   "Mostly natural",
                                   "I don't know",
                                   "Equally humans and natural",
                                   "Mostly humans"))

ccconsensuscausestackedbarplotcombined <- ggplot(CCconsensuscausesummaryallcombined, aes(y=rel.freq, x=prepost)) + 
    geom_col(aes(fill=Answer)) +
  ylab("Percent of responses") +
  xlab("Timing of survey") +
  scale_fill_manual(values=c("gray","#bf812d","#d8b365","#f6e8c3","#ABD9D5","#01665e")) +
  ggtitle("What is the scientific consensus regarding \nthe cause(s) of climate change?") +
  guides(fill=guide_legend(title="Response")) +
  ylim(0,105) +
  annotate("text", x = 1, y = 105, label = paste("n = 372")) +
  annotate("text", x = 2, y = 105, label = paste("n = 383")) +
  theme_bw()

ccconsensuscausestackedbarplotcombined

save_plot("ccconsensuscausestackedbarplotcombined.jpg", ccconsensuscausestackedbarplotcombined, base_width = 6.5, base_height = 5)

```



## Scientists have a good understanding of whether climate change is occurring
### Views on scientific consensus about whether climate change is happening
```{r, analysis of scientists consensus on whether using combined data}
CCScientistsWhetherPrecombined <- cctookbothcombined$CC_ScientistsWhether_pre
CCScientistsWhetherPrecombined <- as.data.frame(CCScientistsWhetherPrecombined)
names(CCScientistsWhetherPrecombined)[1] = c("Answer")

CCScientistsWhetherPostcombined <- cctookbothcombined$CC_ScientistsWhether_post
CCScientistsWhetherPostcombined <- as.data.frame(CCScientistsWhetherPostcombined)
names(CCScientistsWhetherPostcombined)[1] = c("Answer")

CCScientistsWhetherPrecombined$prepost <- rep("pre",nrow(CCScientistsWhetherPrecombined))
CCScientistsWhetherPostcombined$prepost <- rep("post",nrow(CCScientistsWhetherPostcombined))

CCScientistsWhetherDataBindcombined <- bind_rows(CCScientistsWhetherPrecombined,CCScientistsWhetherPostcombined)

CCScientistsWhetherDataBindcombined$Answer <- factor(CCScientistsWhetherDataBindcombined$Answer, 
                                            c("StronglyAgree",
                                              "SomewhatAgree", 
                                              "Neither",
                                              "SomewhatDisagree",
                                              "StronglyDisagree",
                                              "DK"))

CCScientistsWhetherDataBindcombined$prepost <- factor(CCScientistsWhetherDataBindcombined$prepost, 
                                            c("pre",
                                              "post"))
```


```{r, making Likert style plot on scientists whether using combined data}
CCScientistsWhetherDataBindcombined <- CCScientistsWhetherDataBindcombined %>%
  filter(Answer != "")

CCScientistsWhetherDataBindNoDKcombined <- CCScientistsWhetherDataBindcombined %>%
  filter(Answer != "DK")

ccscientistswhetherresponsescombined <- CCScientistsWhetherDataBindNoDKcombined %>%
  select(Answer)

CCScientistsWhetherDataBindNoDKcombined$prepost <- plyr::mapvalues(CCScientistsWhetherDataBindNoDKcombined$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCScientistsWhetherDataBindNoDKcombined$prepost <- factor(CCScientistsWhetherDataBindNoDKcombined$prepost, c("Post","Pre"))

# rename and order the responses

ccscientistswhetherresponsescombined$Answer <- plyr::mapvalues(ccscientistswhetherresponsescombined$Answer, from = c("StronglyAgree",
                                              "SomewhatAgree",
                                              "Neither",
                                              "SomewhatDisagree",
                                              "StronglyDisagree"), 
                                   to = c("Strongly Agree",
                                              "Somewhat Agree",
                                              "Neither",
                                              "Somewhat Disagree",
                                              "Strongly Disagree"))

ccscientistswhetherresponsescombined$Answer <- factor(ccscientistswhetherresponsescombined$Answer, 
                                 c("Strongly Disagree",
                                   "Somewhat Disagree",
                                    "Neither",
                                    "Somewhat Agree",
                                    "Strongly Agree"))

ccscientistswhetherresponsescombined_grouping <- CCScientistsWhetherDataBindNoDKcombined %>%
  select(prepost)

counts = CCScientistsWhetherDataBindNoDKcombined %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(ccscientistswhetherresponsescombined)[1] <- "Scientists have a good understanding of whether climate change is occurring"
likert_ccscientistswhethercombined <- likert(ccscientistswhetherresponsescombined, grouping = ccscientistswhetherresponsescombined_grouping$prepost)


ccscientistswhetherlikertplotcombined = plot(likert_ccscientistswhethercombined,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  annotate("text", x = 2, y = -50, label = paste("n = 367")) +
  annotate("text", x = 1, y = -50, label = paste("n = 379")) +
  guides(fill = guide_legend(nrow=2))

ccscientistswhetherlikertplotcombined <- ggplot_gtable(ggplot_build(ccscientistswhetherlikertplotcombined))
ccscientistswhetherlikertplotcombined$layout$clip <- "off"
ccscientistswhetherlikertplotcombined.mpg <- plot(ccscientistswhetherlikertplotcombined) 

plot(ccscientistswhetherlikertplotcombined)

save_plot("ccscientistswhetherlikertplotcombined.jpg", ccscientistswhetherlikertplotcombined, base_width = 12, base_height = 5)

CCScientistsWhetherDataBindDKcombined <- CCScientistsWhetherDataBindcombined %>%
  filter(Answer == "DK")


CCScientistsWhetherDataBindcombinedsummary <- CCScientistsWhetherDataBindcombined %>%
  group_by(prepost, Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCScientistsWhetherDataBindcombinedsummary

samplesizes <- CCScientistsWhetherDataBindcombined %>%
  group_by(prepost) %>%
  summarise(n=n()) 

samplesizes
```

```{r, test for significant shift in scientists whether}
stronglyagree <- prop.test(x = c(200, 303), n = c(372, 383))
stronglyagree 
```

## Views on scientific consensus on why climate change is happening
```{r, analysis of scientists consensus on why for combined data}
CCScientistsWhyPrecombined <- cctookbothcombined$CC_ScientistsWhy_pre
CCScientistsWhyPrecombined <- as.data.frame(CCScientistsWhyPrecombined)
names(CCScientistsWhyPrecombined)[1] = c("Answer")

CCScientistsWhyPostcombined <- cctookbothcombined$CC_ScientistsWhy_post
CCScientistsWhyPostcombined <- as.data.frame(CCScientistsWhyPostcombined)
names(CCScientistsWhyPostcombined)[1] = c("Answer")

CCScientistsWhyPrecombined$prepost <- rep("pre",nrow(CCScientistsWhyPrecombined))
CCScientistsWhyPostcombined$prepost <- rep("post",nrow(CCScientistsWhyPostcombined))

CCScientistsWhyDataBindcombined <- bind_rows(CCScientistsWhyPrecombined,CCScientistsWhyPostcombined)

CCScientistsWhyDataBindcombined$Answer <- factor(CCScientistsWhyDataBindcombined$Answer, 
                                            c("StronglyAgree",
                                              "SomewhatAgree", 
                                              "Neither",
                                              "SomewhatDisagree",
                                              "StronglyDisagree",
                                              "DK"))

CCScientistsWhyDataBindcombined$prepost <- factor(CCScientistsWhyDataBindcombined$prepost, 
                                            c("pre",
                                              "post"))

```


```{r, making Likert style plot on scientists why for combined data}
CCScientistsWhyDataBindcombined <- CCScientistsWhyDataBindcombined  %>%
  filter(Answer != "")

CCScientistsWhyDataBindNoDKcombined <- CCScientistsWhyDataBindcombined %>%
  filter(Answer != "DK")

ccscientistswhyresponsescombined <- CCScientistsWhyDataBindNoDKcombined %>%
  select(Answer)

CCScientistsWhyDataBindNoDKcombined$prepost <- plyr::mapvalues(CCScientistsWhyDataBindNoDKcombined$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCScientistsWhyDataBindNoDKcombined$prepost <- factor(CCScientistsWhyDataBindNoDKcombined$prepost, c("Post","Pre"))

# rename and order the responses

ccscientistswhyresponsescombined$Answer <- plyr::mapvalues(ccscientistswhyresponsescombined$Answer, from = c("StronglyAgree",
                                              "SomewhatAgree",
                                              "Neither",
                                              "SomewhatDisagree",
                                              "StronglyDisagree"), 
                                   to = c("Strongly Agree",
                                              "Somewhat Agree",
                                              "Neither",
                                              "Somewhat Disagree",
                                              "Strongly Disagree"))

ccscientistswhyresponsescombined$Answer <- factor(ccscientistswhyresponsescombined$Answer, 
                                 c("Strongly Disagree",
                                   "Somewhat Disagree",
                                    "Neither",
                                    "Somewhat Agree",
                                    "Strongly Agree"))

ccscientistswhyresponsescombined_grouping <- CCScientistsWhyDataBindNoDKcombined %>%
  select(prepost)

counts = CCScientistsWhyDataBindNoDKcombined %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(ccscientistswhyresponsescombined)[1] <- "Scientists have a good understanding of why climate change is occurring"
likert_ccscientistswhycombined <- likert(ccscientistswhyresponsescombined, grouping = ccscientistswhyresponsescombined_grouping$prepost)


ccscientistswhylikertplotcombined = plot(likert_ccscientistswhycombined,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  guides(fill = guide_legend(nrow=2)) + 
  annotate("text", x = 2, y = -50, label = paste("n = 366")) +
  annotate("text", x = 1, y = -50, label = paste("n = 381"))

ccscientistswhylikertplotcombined <- ggplot_gtable(ggplot_build(ccscientistswhylikertplotcombined))
ccscientistswhylikertplotcombined$layout$clip <- "off"
ccscientistswhylikertplotcombined.mpg <- plot(ccscientistswhylikertplotcombined) 

plot(ccscientistswhylikertplotcombined)

save_plot("ccscientistswhylikertplotcombined.jpg", ccscientistswhylikertplotcombined, base_width = 12, base_height = 5)

CCScientistsWhyDataBindDKcombined <- CCScientistsWhyDataBindcombined %>%
  filter(Answer == "DK")

CCScientistsWhyDataBindcombinedsummary <- CCScientistsWhyDataBindcombined %>%
  group_by(prepost, Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCScientistsWhyDataBindcombinedsummary

samplesizes <- CCScientistsWhyDataBindcombined %>%
  group_by(prepost) %>%
  summarise(n=n()) 

samplesizes
```

```{r, test for significant shift in scientists why}
stronglyagree <- prop.test(x = c(105, 230), n = c(372, 383))
stronglyagree 
```

### Combined plot for whether & why combined data
```{r, combined whether & why plot for combined data}
combinedccwhetherwhyplotcombined <- plot_grid(ccscientistswhetherlikertplotcombined, ccscientistswhylikertplotcombined, labels=c('A', 'B'), nrow=2, ncol=1)
combinedccwhetherwhyplotcombined

save_plot("combinedccwhetherwhyplotcombined.jpg", combinedccwhetherwhyplotcombined, base_width = 8, base_height = 8)
```

## What are student views on whether there's a consensus that temperatures have increased in the past century?

CC_ConsensusTemp
There is a strong scientific consensus that Earth’s temperature has increased in the past century.
o Strongly agree
o Somewhat agree
o Neither agree nor disagree
o Somewhat disagree
o Strongly disagree
o I don’t know

```{r, analysis of scientific consensus on temp change}
CCConsensusTempPre <- cctookboth$CC_ConsensusTemp_pre
CCConsensusTempPre <- as.data.frame(CCConsensusTempPre)
names(CCConsensusTempPre)[1] = c("Answer")

CCConsensusTempPost <- cctookboth$CC_ConsensusTemp_post
CCConsensusTempPost <- as.data.frame(CCConsensusTempPost)
names(CCConsensusTempPost)[1] = c("Answer")

CCConsensusTempPre$prepost <- rep("pre",nrow(CCConsensusTempPre))
CCConsensusTempPost$prepost <- rep("post",nrow(CCConsensusTempPost))

CCConsensusTempDataBind <- bind_rows(CCConsensusTempPre,CCConsensusTempPost)

CCConsensusTempDataBind$Answer <- factor(CCConsensusTempDataBind$Answer, 
                                            c("StronglyAgree",
                                              "SomewhatAgree", 
                                              "Neither",
                                              "SomewhatDisagree",
                                              "StronglyDisagree",
                                              "DK"))

CCConsensusTempDataBind$prepost <- factor(CCConsensusTempDataBind$prepost, 
                                            c("pre",
                                              "post"))

```


```{r, making Likert style plot on scientific consensus on temp change}
CCConsensusTempDataBind <- CCConsensusTempDataBind  %>%
  filter(Answer != "")

CCConsensusTempDataBindNoDK <- CCConsensusTempDataBind %>%
  filter(Answer != "DK")

ccconsensustempresponses <- CCConsensusTempDataBindNoDK %>%
  select(Answer)

CCConsensusTempDataBindNoDK$prepost <- plyr::mapvalues(CCConsensusTempDataBindNoDK$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCConsensusTempDataBindNoDK$prepost <- factor(CCConsensusTempDataBindNoDK$prepost, c("Post","Pre"))

# rename and order the responses

ccconsensustempresponses$Answer <- plyr::mapvalues(ccconsensustempresponses$Answer, from = c("StronglyAgree",
                                              "SomewhatAgree",
                                              "Neither",
                                              "SomewhatDisagree",
                                              "StronglyDisagree"), 
                                   to = c("Strongly Agree",
                                              "Somewhat Agree",
                                              "Neither",
                                              "Somewhat Disagree",
                                              "Strongly Disagree"))

ccconsensustempresponses$Answer <- factor(ccconsensustempresponses$Answer, 
                                 c("Strongly Disagree",
                                   "Somewhat Disagree",
                                    "Neither",
                                    "Somewhat Agree",
                                    "Strongly Agree"))

ccconsensustempresponses_grouping <- CCConsensusTempDataBindNoDK %>%
  select(prepost)

counts = CCConsensusTempDataBindNoDK %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(ccconsensustempresponses)[1] <- "There is a strong scientific consensus that Earth’s temperature has increased in the past century"
likert_ccconsensustemp <- likert(ccconsensustempresponses, grouping = ccconsensustempresponses_grouping$prepost)

ccconsensustemplikertplot = plot(likert_ccconsensustemp,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  annotate("text", x = 2, y = -50, label = paste("n = 116")) +
  annotate("text", x = 1, y = -50, label = paste("n = 120")) +
  guides(fill = guide_legend(nrow=2))

ccconsensustemplikertplot <- ggplot_gtable(ggplot_build(ccconsensustemplikertplot))
ccconsensustemplikertplot$layout$clip <- "off"
ccscientistswhylikertplot.mpg <- plot(ccconsensustemplikertplot) 

plot(ccconsensustemplikertplot)

save_plot("ccconsensustemplikertplot.jpg", ccconsensustemplikertplot, base_width = 8, base_height = 5)

CCConsensusTempDataBindDK <- CCConsensusTempDataBind %>%
  filter(Answer == "DK")

CCconsensustempsummary <- CCConsensusTempDataBind %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCconsensustempsummary

samplesizes <- CCConsensusTempDataBind %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n()) 

samplesizes
```



## When do students think climate change will start to harm people?
```{r, when will cc start to harm people}
CCHarmPeoplePre <- cctookboth$CC_HarmPeople_pre
CCHarmPeoplePre <- as.data.frame(CCHarmPeoplePre)
names(CCHarmPeoplePre)[1] = c("Answer")

CCHarmPeoplePost <- cctookboth$CC_HarmPeople_post
CCHarmPeoplePost <- as.data.frame(CCHarmPeoplePost)
names(CCHarmPeoplePost)[1] = c("Answer")

CCHarmPeoplePre$prepost <- rep("pre",nrow(CCHarmPeoplePre))
CCHarmPeoplePost$prepost <- rep("post",nrow(CCHarmPeoplePost))

CCHarmPeopleDataBind <- bind_rows(CCHarmPeoplePre,CCHarmPeoplePost)

CCHarmPeopleDataBind$Answer <- factor(CCHarmPeopleDataBind$Answer, 
                                            c("Now",
                                              "Years10",
                                              "Years11to25",
                                              "Years26to50",
                                              "Years51to100",
                                              "After100",
                                              "NotHappening",
                                              "Never"))

CCHarmPeopleDataBind$prepost <- factor(CCHarmPeopleDataBind$prepost, 
                                            c("pre",
                                              "post"))

```

Only 32% of students thought that climate change is harming people now on the pre-survey, whereas 62% of students chose that on the post-survey.

```{r, stacked bar chart of ccharmpeople data}
CCHarmPeopleDataBind$prepost <- plyr::mapvalues(CCHarmPeopleDataBind$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCharmpeoplesummary <- CCHarmPeopleDataBind %>%
  subset(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), digits=1))

CCharmpeoplesummary

ntoplot <- CCHarmPeopleDataBind %>%
  subset(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n()) 

ntoplot

CCharmpeoplesummary$Answer <- plyr::mapvalues(CCharmpeoplesummary$Answer , 
                                              from = c("Now","Years10", "Years11to25","Years26to50","Years51to100","After100","NotHappening"), 
                                              to = c("now","within 10 years","within 11 to 25 years","within 26 to 50 years","within 51 to 100 years","after 100 years", "not happening"))

CCharmpeoplesummary$Answer <- factor(CCharmpeoplesummary$Answer, 
                                     c("not happening",
                                       "after 100 years",
                                     "within 51 to 100 years",
                                     "within 26 to 50 years",
                                     "within 11 to 25 years",
                                     "within 10 years",
                                     "now"))

CCHarmPeoplePrePostPlotv2 <- ggplot(CCharmpeoplesummary) +
  geom_bar(aes(y=rel.freq, x=prepost, fill=Answer),stat='identity') +
  scale_fill_manual(values=c("sienna4","#D8B365", "#dfc27d", "#f6e8c3", "#D3EBE9","#ABD9D5", "#5AB4AC")) +
  theme(axis.title.y=element_blank()) +
  annotate("text",x=1,y=105,label="n = 120",size=3) +
  annotate("text",x=2,y=105,label="n = 119",size=3) +
  labs(y="Percent of responses",x = "Timing of survey") +
  labs(fill="Response") +
  ggtitle("When do you think climate change will start to harm people?")  +
    theme(plot.title = element_text(size = 16, face = "plain")) +
    theme(legend.position="bottom") + 
  theme_bw()
  
CCHarmPeoplePrePostPlotv2

save_plot("CCHarmPeoplePrePostPlotv2.jpg", CCHarmPeoplePrePostPlotv2, base_width = 6.5, base_height = 5)
```

```{r, test for significant shift in when will impact}
now <- prop.test(x = c(39, 74), n = c(120, 119))
now
```


## How much do students think climate change will harm them?
Question & answer options:
How much do you think climate change will harm you personally?
o Not at all, because climate change is not happening
o Not at all, even though climate change is happening
o Only a little
o A moderate amount
o A great deal
o I don’t know

The codes for those in the data are:
- NotHappening
- Somewhat {which doesn't make sense given the answer text, but Kyle confirmed this on December 4 2018}
- Little
- Moderate
- GreatDeal
- DK

```{r, how much will cc harm them}
CCHarmYouPre <- cctookboth$CC_HarmYou_pre
CCHarmYouPre <- as.data.frame(CCHarmYouPre)
names(CCHarmYouPre)[1] = c("Answer")

CCHarmYouPost <- cctookboth$CC_HarmYou_post
CCHarmYouPost <- as.data.frame(CCHarmYouPost)
names(CCHarmYouPost)[1] = c("Answer")

CCHarmYouPre$prepost <- rep("pre",nrow(CCHarmYouPre))
CCHarmYouPost$prepost <- rep("post",nrow(CCHarmYouPost))

CCHarmYouDataBind <- bind_rows(CCHarmYouPre,CCHarmYouPost)

CCHarmYouDataBind$Answer <- factor(CCHarmYouDataBind$Answer, 
                                            c("GreatDeal",
                                              "Moderate",
                                              "Little",
                                              "Somewhat",
                                              "NotHappening",
                                              "DK"))

CCHarmYouDataBind$prepost <- factor(CCHarmYouDataBind$prepost, 
                                            c("pre",
                                              "post"))

```


```{r, stacked bar chart of ccharmyou data}
CCHarmYouDataBindSubset <- CCHarmYouDataBind %>%
  filter(Answer != "")

ccharmyouresponses <- CCHarmYouDataBindSubset %>%
  select(Answer)

CCHarmYouDataBindSubset$prepost <- plyr::mapvalues(CCHarmYouDataBindSubset$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCharmyousummary <- CCHarmYouDataBind %>%
  subset(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), digits=1))

CCharmyousummary

ntoplot <- CCHarmYouDataBind %>%
  group_by(prepost) %>%
  summarise(n=n()) 

ntoplot

# see note at the beginning of the harmyou section about the weird mapping of "somewhat"
CCharmyousummary$Answer <- plyr::mapvalues(CCharmyousummary$Answer , 
                                              from = c("NotHappening","Somewhat","DK", "Little","Moderate","GreatDeal"), 
                                              to = c("Not at all, not happening","Not at all, happening","I dont know", "Only a little","A moderate amount","A great deal"))

CCharmyousummary$Answer <- factor(CCharmyousummary$Answer, 
                                     c("Not at all, not happening","Not at all, happening","I dont know", "Only a little","A moderate amount","A great deal"))

CCHarmYouPrePostPlotv2 <- ggplot(CCharmyousummary) +
  geom_bar(aes(y=rel.freq, x=prepost, fill=Answer),stat='identity') +
  scale_fill_manual(values=c("black","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac")) +
  theme(axis.title.y=element_blank()) +
  annotate("text",x=1,y=105,label="n = 120",size=3) +
  annotate("text",x=2,y=105,label="n = 120",size=3) +
  labs(y="Percent of responses", x = "Timing of survey") +
  labs(fill="Response") +
  ggtitle("How much do you think climate change will harm you personally?")  +
    theme(plot.title = element_text(size = 16, face = "plain")) +
    theme(legend.position="bottom") + 
  theme_bw()
  
CCHarmYouPrePostPlotv2

save_plot("CCHarmYouPrePostPlotv2.jpg", CCHarmYouPrePostPlotv2, base_width = 6.5, base_height = 5)
```

### Combined plot for when & how much data
```{r, combined plot of when and how much data}
combinedccharmplot <- plot_grid(CCHarmPeoplePrePostPlotv2, CCHarmYouPrePostPlotv2, labels=c('A', 'B'), nrow=2, ncol=1)
combinedccharmplot

save_plot("combinedccharmplot.jpg", combinedccharmplot, base_width = 6, base_height = 8)
```


## Do students feel that the course changed how they think about climate change?

### Going to just Fall 2017 data to compare reported ability to change mind (on pre-survey) with impact of the course on their views

```{r, trying a heat map for the F17 change data}
library(lattice)

ccchangewide <- cctookboth %>%
  subset(CC_ChangeMind_pre != "" & CC_ChangedMe_post != "") %>%
  select(CC_ChangeMind_pre, CC_ChangedMe_post)


# Set response options
options <- c("StronglyDisagree", "SomewhatDisagree","Neither","SomewhatAgree","StronglyAgree")
n_options <- length(options)

# Create new dataframe to plot CC_Happening data as heatmap
df_cc_change <- matrix(nrow=n_options, ncol=n_options)
for (i in 1:nrow(df_cc_change)) {
  for (j in 1:ncol(df_cc_change)) {
    df_cc_change[i,j] <- sum(ccchangewide$CC_ChangeMind_pre == options[i] & ccchangewide$CC_ChangedMe_post == options[j])
  }
}

# Plot heatmap for CC_Happening Question
xylabels <- c("Strongly\nDisagree", "Somewhat\nDisagree","Neither","Somewhat\nAgree","Strongly\nAgree")

changeheatmapplot <- levelplot(df_cc_change, at=seq(0,max(df_cc_change),1), 
		  col.regions=colorRampPalette(c("white","blue")),
		  xlab="Pre-Survey Response", ylab="Post-Survey Response",
		  scales=(list(labels=xylabels, at = seq(1,5,1))),
		  main = "Could you/did you change your views? (n=120)"
		  )

changeheatmapplot


```

## How much had you thought about climate change before this course?

```{r, how much thought using combined data}
CCThoughtPrecombined <- cctookbothcombined$CC_Thought_pre
CCThoughtPrecombined <- as.data.frame(CCThoughtPrecombined)
names(CCThoughtPrecombined)[1] = c("Answer")

CCThoughtPostcombined <- cctookbothcombined$CC_Thought_post
CCThoughtPostcombined <- as.data.frame(CCThoughtPostcombined)
names(CCThoughtPostcombined)[1] = c("Answer")

CCThoughtPrecombined$prepost <- rep("pre",nrow(CCThoughtPrecombined))
CCThoughtPostcombined$prepost <- rep("post",nrow(CCThoughtPostcombined))

CCThoughtDataBindcombined <- bind_rows(CCThoughtPrecombined,CCThoughtPostcombined)

CCThoughtDataBindcombined$Answer <- factor(CCThoughtDataBindcombined$Answer, 
                                            c("ALot",
                                              "Some",
                                              "Little",
                                              "NotAtAll"))

CCThoughtDataBindcombined$prepost <- factor(CCThoughtDataBindcombined$prepost, 
                                            c("pre",
                                              "post"))

CCthoughtsummarycombined <- CCThoughtDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCthoughtsummarycombined

ntoplot <- CCThoughtDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n())

ntoplot 
```

```{r, test for significant shift in thought}
alot <- prop.test(x = c(107, 103), n = c(372, 382))
alot 

little <- prop.test(x = c(95, 121), n = c(372, 382))
little
```

```{r, making Likert style plot on how much thought data using combined data}
CCThoughtDataBindSubsetcombined <- CCThoughtDataBindcombined %>%
  filter(Answer != "")

ccthoughtresponsescombined <- CCThoughtDataBindSubsetcombined %>%
  select(Answer)

CCThoughtDataBindSubsetcombined$prepost <- plyr::mapvalues(CCThoughtDataBindSubsetcombined$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCThoughtDataBindSubsetcombined$prepost <- factor(CCThoughtDataBindSubsetcombined$prepost, c("Post","Pre"))

# rename and order the responses

ccthoughtresponsescombined$Answer <- plyr::mapvalues(ccthoughtresponsescombined$Answer, from = c("ALot",
                                              "Some",
                                              "Little",
                                              "NotAtAll"), 
                                   to = c("A lot",
                                              "Some",
                                              "A little",
                                              "Not at all"))

ccthoughtresponsescombined$Answer <- factor(ccthoughtresponsescombined$Answer, 
                                 c("Not at all",
                                   "A little",
                                    "Some",
                                    "A lot"))

ccthoughtresponsescombined_grouping <- CCThoughtDataBindSubsetcombined %>%
  select(prepost)

counts = CCThoughtDataBindSubsetcombined %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(ccthoughtresponsescombined)[1] <- "How much had you thought about climate change before this course?"
likert_ccthoughtcombined <- likert(ccthoughtresponsescombined, grouping = ccthoughtresponsescombined_grouping$prepost)


ccthoughtlikertplotcombined = plot(likert_ccthoughtcombined,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  annotate("text",x=1,y=-60,label="n = 382",size=4) +
  annotate("text",x=2,y=-60,label="n = 372",size=4) 

ccthoughtlikertplotcombined <- ggplot_gtable(ggplot_build(ccthoughtlikertplotcombined))
ccthoughtlikertplotcombined$layout$clip <- "off"
ccthoughtlikertplotcombined.mpg <- plot(ccthoughtlikertplotcombined) 

plot(ccthoughtlikertplotcombined)

save_plot("ccthoughtlikertplotcombined.jpg", ccthoughtlikertplotcombined, base_width = 8, base_height = 5)

```

## How worried are students about climate change?
```{r, analysis of amount of worry combined data}
CCWorriedPrecombined <- cctookbothcombined$CC_Worried_pre
CCWorriedPrecombined <- as.data.frame(CCWorriedPrecombined)
names(CCWorriedPrecombined)[1] = c("Answer")

CCWorriedPostcombined <- cctookbothcombined$CC_Worried_post
CCWorriedPostcombined <- as.data.frame(CCWorriedPostcombined)
names(CCWorriedPostcombined)[1] = c("Answer")

CCWorriedPrecombined$prepost <- rep("pre",nrow(CCWorriedPrecombined))
CCWorriedPostcombined$prepost <- rep("post",nrow(CCWorriedPostcombined))

CCWorriedDataBindcombined <- bind_rows(CCWorriedPrecombined,CCWorriedPostcombined)

CCWorriedDataBindcombined$Answer <- factor(CCWorriedDataBindcombined$Answer, 
                                            c("Very",
                                              "Somewhat", 
                                              "Neither",
                                              "NotVery",
                                              "NotAtAll"))

CCWorriedDataBindcombined$prepost <- factor(CCWorriedDataBindcombined$prepost, 
                                            c("pre",
                                              "post"))

CCworriedsummarycombined <- CCWorriedDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCworriedsummarycombined

ntoplot <- CCWorriedDataBindcombined %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n())

ntoplot 
```


```{r, making Likert style plot on worry data using combined data}
CCWorriedDataBindSubsetcombined <- CCWorriedDataBindcombined %>%
  filter(Answer != "")

ccworriedresponsescombined <- CCWorriedDataBindSubsetcombined %>%
  select(Answer)

CCWorriedDataBindSubsetcombined$prepost <- plyr::mapvalues(CCWorriedDataBindSubsetcombined$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCWorriedDataBindSubsetcombined$prepost <- factor(CCWorriedDataBindSubsetcombined$prepost, c("Post","Pre"))

# rename and order the responses

ccworriedresponsescombined$Answer <- plyr::mapvalues(ccworriedresponsescombined$Answer, from = c("NotAtAll",
                                   "NotVery",
                                    "Neither",
                                    "Somewhat",
                                    "Very"), 
                                   to = c("Not at all",
                                   "Not very",
                                    "Neither",
                                    "Somewhat",
                                    "Very"))

ccworriedresponsescombined$Answer <- factor(ccworriedresponsescombined$Answer, 
                                 c("Not at all",
                                   "Not very",
                                    "Neither",
                                    "Somewhat",
                                    "Very"))

ccworriedresponsescombined_grouping <- CCWorriedDataBindSubsetcombined %>%
  select(prepost)

counts = CCWorriedDataBindSubsetcombined %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(ccworriedresponsescombined)[1] <- "How worried are you about climate change?"
likert_ccworriedcombined <- likert(ccworriedresponsescombined, grouping = ccworriedresponsescombined_grouping$prepost)


ccworriedlikertplotcombined = plot(likert_ccworriedcombined,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  annotate("text",x=1,y=-60,label="n = 379",size=4) +
  annotate("text",x=2,y=-60,label="n = 375",size=4) +
  guides(fill = guide_legend(nrow=2))
  

ccworriedlikertplotcombined <- ggplot_gtable(ggplot_build(ccworriedlikertplotcombined))
ccworriedlikertplotcombined$layout$clip <- "off"
ccworriedlikertplotcombined.mpg <- plot(ccworriedlikertplotcombined) 

plot(ccworriedlikertplotcombined)

save_plot("ccworriedlikertplotcombined.jpg", ccworriedlikertplotcombined, base_width = 8, base_height = 5)

CCWorriedDataBindSubsetcombinedsummary <- CCWorriedDataBindSubsetcombined %>%
  group_by(prepost, Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCWorriedDataBindSubsetcombinedsummary

```

```{r, test for significant shift in worry}
veryworried <- prop.test(x = c(160, 221), n = c(375, 379))
veryworried
```

## How important is the issue of climate change to you personally?
```{r, how personally important}
CCImportantPre <- cctookboth$CC_Important_pre
CCImportantPre <- as.data.frame(CCImportantPre)
names(CCImportantPre)[1] = c("Answer")

CCImportantPost <- cctookboth$CC_Important_post
CCImportantPost <- as.data.frame(CCImportantPost)
names(CCImportantPost)[1] = c("Answer")

CCImportantPre$prepost <- rep("pre",nrow(CCImportantPre))
CCImportantPost$prepost <- rep("post",nrow(CCImportantPost))

CCImportantDataBind <- bind_rows(CCImportantPre,CCImportantPost)

CCImportantDataBind$Answer <- factor(CCImportantDataBind$Answer, 
                                            c("Extremely",
                                              "Very",
                                              "Neither",
                                              "MostlyNot",
                                              "NotAtAll"))

CCImportantDataBind$prepost <- factor(CCImportantDataBind$prepost, 
                                            c("pre",
                                              "post"))
```

```{r, making Likert style plot on how important data}
CCImportantDataBindSubset <- CCImportantDataBind %>%
  filter(Answer != "")

ccimportantresponses <- CCImportantDataBindSubset %>%
  select(Answer)

CCimportantsummary <- CCImportantDataBindSubset %>%
  group_by(prepost, Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCimportantsummary

ntoplot <- CCImportantDataBindSubset %>%
  group_by(prepost) %>%
  summarise(n=n()) 

ntoplot

CCImportantDataBindSubset$prepost <- plyr::mapvalues(CCImportantDataBindSubset$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCImportantDataBindSubset$prepost <- factor(CCImportantDataBindSubset$prepost, c("Post","Pre"))

# rename and order the responses

ccimportantresponses$Answer <- plyr::mapvalues(ccimportantresponses$Answer, from = c("Extremely",
                                              "Very",
                                              "Neither",
                                              "MostlyNot",
                                              "NotAtAll"), 
                                   to = c("Extremely important",
                                              "Very important",
                                              "Neither important nor unimportant",
                                              "Mostly not important",
                                              "Not at all important"))

ccimportantresponses$Answer <- factor(ccimportantresponses$Answer, 
                                 c("Not at all important",
                                   "Mostly not important",
                                    "Neither important nor unimportant",
                                    "Very important",
                                    "Extremely important"))

ccimportantresponses_grouping <- CCImportantDataBindSubset %>%
  select(prepost)

counts = CCImportantDataBindSubset %>%
  count(prepost) %>%
  mutate(variable=NA)

colnames(ccimportantresponses)[1] <- "How important is the issue of climate change to you personally?"
likert_ccimportant <- likert(ccimportantresponses, grouping = ccimportantresponses_grouping$prepost)


ccimportantlikertplot = plot(likert_ccimportant,legend.position="bottom",text.size=4) + 
  scale_y_continuous(limits=c(-100,150)) +
  coord_flip(ylim=c(-110,110)) +
  theme(text = element_text(size=17), strip.text.x = element_text(size = 18)) +
  annotate("text",x=1,y=-60,label="n = 119",size=4) +
  annotate("text",x=2,y=-60,label="n = 120",size=4) +
  guides(fill = guide_legend(nrow=2))

ccimportantlikertplot <- ggplot_gtable(ggplot_build(ccimportantlikertplot))
ccimportantlikertplot$layout$clip <- "off"
ccimportantlikertplot.mpg <- plot(ccimportantlikertplot) 

plot(ccimportantlikertplot)

save_plot("ccimportantlikertplot.jpg", ccimportantlikertplot, base_width = 8, base_height = 5)

```

```{r, another test for significant shift in thought}
important <- prop.test(x = c(72, 95), n = c(120, 119))
important
```

### Combined plot for worried & important data
```{r, combined plot of worried and important data}
combinedworryimportantplot <- plot_grid(ccworriedlikertplotcombined, ccimportantlikertplot, labels=c('A', 'B'), nrow=2, ncol=1)
combinedworryimportantplot

save_plot("combinedworryimportantplot.jpg", combinedworryimportantplot, base_width =9.5, base_height = 8)
```

## Which of the following statements comes closest to your view?

Answer options:
o Climate change isn’t happening.
o Climate change is happening, but humans can’t reduce climate change.
o Climate change is happening. Humans can reduce climate change, but people aren’t willing to change their behavior so we’re not going to.
o Climate change is happening. Humans could reduce climate change, but it’s unclear at this point whether we will do what’s needed.
o Climate change is happening. Humans can reduce climate change, and we are going to do so successfully.
o Climate change is happening. Humans don’t need to try to reduce climate change, because climate change is primarily controlled by natural processes.

The codes for those in the data are:
-NotHappening
-CantReduce
-Unwilling
-Unclear
-Success
-DontNeed

Note: I was initially confused about what was going on with the "can't reduce" option, since it appeared as a level in R but wasn't appearing on the figure. Looking into it more, some students chose that option, but the only students who chose it were students who answered the validation question incorrectly at the beginning and/or end of the semester. So, it doesn't appear on the figure because those students are filtered out.

```{r, views on CC}
CCViewPre <- cctookboth$CC_View_pre
CCViewPre <- as.data.frame(CCViewPre)
names(CCViewPre)[1] = c("Answer")

CCViewPost <- cctookboth$CC_View_post
CCViewPost <- as.data.frame(CCViewPost)
names(CCViewPost)[1] = c("Answer")

CCViewPre$prepost <- rep("pre",nrow(CCViewPre))
CCViewPost$prepost <- rep("post",nrow(CCViewPost))

CCViewDataBind <- bind_rows(CCViewPre,CCViewPost)

CCViewDataBind$Answer <- factor(CCViewDataBind$Answer, 
                                            c("DontNeed",
                                              "Success",
                                              "Unclear",
                                              "Unwilling",
                                              "CantReduce",
                                              "NotHappening"))

CCViewDataBind$prepost <- factor(CCViewDataBind$prepost, 
                                            c("pre",
                                              "post"))

```

```{r, trying a new plot of the CCView data that is arranged differently}
CCViewPercents <- 
  CCViewDataBind %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

extradata <- data.frame(prepost = c("pre","post"), Answer = c("CantReduce","CantReduce"), n = c(0, 0),rel.freq=c(0, 0))

CCViewPercents <- bind_rows(CCViewPercents,extradata)

CCViewPercents

ntoplot <- CCViewDataBind %>%
  filter(Answer != "") %>%
  group_by(prepost) %>%
  summarise(n=n())

ntoplot

CCViewPercents$prepost <- plyr::mapvalues(CCViewPercents$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCViewPercents$prepost <- factor(CCViewPercents$prepost, c("Post","Pre"))

CCViewPercents$Answer <- factor(CCViewPercents$Answer, 
                                            c("DontNeed",
                                              "Success",
                                              "Unclear",
                                              "Unwilling",
                                              "CantReduce",
                                              "NotHappening"))

CCViewFlippedPlot <- ggplot(CCViewPercents,aes(x=Answer,y=rel.freq,fill= prepost)) +
  geom_bar(stat="identity",position=position_dodge()) +
  ylab("Percent of responses (n = 120)") +
  coord_flip() +
  theme(axis.text.y = element_blank()) +
  annotate("text", x = 1, y = 2, label = "Climate change is happening. Humans don’t need to try to reduce climate\nchange, because climate change is primarily controlled by natural processes.",hjust=0,size=5) +
  annotate("text", x = 2, y = 5, label = "Climate change is happening. Humans can reduce climate change,\nand we are going to do so successfully.",hjust=0,size=5) +
  annotate("text", x = 3, y = 1, label = "Climate change is happening. Humans could reduce climate change,\nbut it’s unclear at this point whether we will do what’s needed.",hjust=0,size=5) +
  annotate("text", x = 4, y = 1, label = "Climate change is happening. Humans can reduce climate change,\nbut people aren’t willing to change their behavior so we’re not going to.",hjust=0,size=5) +
  annotate("text", x = 5, y = 1, color="black", label = "Climate change is happening, but humans can’t reduce climate change.",hjust=0,size=5) +
  annotate("text", x = 6, y = 3, color="black", label = "Climate change isn’t happening.",hjust=0,size=5) +
  scale_fill_manual(values=c("#999999", "#56B4E9")) +
  guides(fill = guide_legend(reverse=TRUE)) +
  theme(legend.title=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))

CCViewFlippedPlot


save_plot("CCViewFlippedPlot2.jpg", CCViewFlippedPlot, base_width = 8.5, base_height = 6)
```

## Do their friends share their views on climate change?
CC_Friends
How many of your friends share your views on climate change?
o None
o A few
o Some
o Most
o All
o I don’t know

```{r, initial plotting of data on friend views}
CCFriendsPre <- cctookboth$CC_Friends_pre
CCFriendsPre <- as.data.frame(CCFriendsPre)
names(CCFriendsPre)[1] = c("Answer")

CCFriendsPost <- cctookboth$CC_Friends_post
CCFriendsPost <- as.data.frame(CCFriendsPost)
names(CCFriendsPost)[1] = c("Answer")

CCFriendsPre$prepost <- rep("pre",nrow(CCFriendsPre))
CCFriendsPost$prepost <- rep("post",nrow(CCFriendsPost))

CCFriendsDataBind <- bind_rows(CCFriendsPre,CCFriendsPost)

CCFriendsDataBind$Answer <- factor(CCFriendsDataBind$Answer, 
                                            c("All",
                                              "Most", 
                                              "Some",
                                              "Few",
                                              "None",
                                              "DK"))

CCFriendsDataBind$prepost <- factor(CCFriendsDataBind$prepost, 
                                            c("pre",
                                              "post"))

```

```{r, stacked bar chart for friends data}
CCFriendsDataBindAll <- CCFriendsDataBind

CCFriendsDataBindAll$prepost <- plyr::mapvalues(CCFriendsDataBindAll$prepost , from = c("pre", "post"), to = c("Pre","Post"))

CCfriendssummaryall <- CCFriendsDataBindAll %>%
  filter(Answer != "") %>%
  group_by(prepost,Answer) %>%
  summarise(n=n()) %>%
  mutate(rel.freq = round(100 * n/sum(n), 0))

CCfriendssummaryall

# order the responses
CCfriendssummaryall$Answer <- factor(CCfriendssummaryall$Answer, 
                                 c("NA",
                                   "DK",
                                   "None",
                                   "Few",
                                   "Some",
                                   "Most",
                                   "All"))


ccfriendsstackedbarplot <- ggplot(CCfriendssummaryall, aes(y=rel.freq, x=prepost)) + 
    geom_col(aes(fill=Answer)) +
  ylab("Percent of responses") +
  xlab("Timing of survey") +
  scale_fill_manual(values=c("gray","#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac")) +
  ggtitle("How many of your friends share your views on climate change?") +
  theme_bw()
  

ccfriendsstackedbarplot

save_plot("ccfriendsstackedbarplot.jpg", ccfriendsstackedbarplot, base_width = 6, base_height = 5)

```

